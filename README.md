# Building Lightningcss (napi-v3 based)

Context: [Bumping napi-rs to v3? #1113](https://github.com/parcel-bundler/lightningcss/discussions/1113)

## Notes on Uncommitted Patches

- `node_index.patch` is an updated JS binding generated by `npx napi build`, with the `WASI` section removed manually.
- `node_test_error_message.patch` The original errors come from `format!("expect {:?}, got: {:?}", $value_type, value_type),` in `crates/napi/src/js_values/mod.rs` from `napi-rs`. This project mainly validates how close it is to the upstream v2-based repo, so the error messages are temporarily replaced.
- `node_test_wasm_skip_loc.patch` This was introduced in napi v3.4.0 (released on 2025-10-24): [stop ref error object in wasm targets (#2975)](https://github.com/napi-rs/napi-rs/pull/2975). I tried to ref the object similarly in the non-wasm implementation of `from`, but more tests failed. This patch is intentionally generated without changing the indention of the error location info.
- `rust-toolchain.patch` Uses the latest stable Rust toolchain.
